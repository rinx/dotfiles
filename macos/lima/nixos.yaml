# Template using nixos-lima
# ref: https://github.com/nixos-lima/nixos-lima
images:
  - location: "https://github.com/nixos-lima/nixos-lima/releases/download/v0.0.4/nixos-lima-v0.0.4-aarch64.qcow2"
    arch: "aarch64"
    digest: "sha512:a274d225c41918da7f1bb0bc1fde8cc713ed0d36954c21cc26ae403d47879a00f4c3d5601c67c647df87f6f321e1b694140b671910b15a011872311b960569b2"
  - location: "https://github.com/nixos-lima/nixos-lima/releases/download/v0.0.4/nixos-lima-v0.0.4-x86_64.qcow2"
    arch: "x86_64"
    digest: "sha512:5daac286d415a579ca659a98de864fe04ab7a1879d4e4608e3edcd2e931f1848f88ed07316e69a1131ab35b88158b999a21cc5ccf9be9c3d04f51a7e58dc8580"
mounts:
  - location: "~"
    writable: false
    9p:
      # Try choosing "mmap" or "none" if you see a stability issue with the default "fscache".
      cache: "mmap"
  - location: "/tmp/lima"
    writable: true
    9p:
      cache: "mmap"
  - location: "~/.dotfiles"
    writable: true
    9p:
      cache: "mmap"
  - location: "~/local"
    mountPoint: "{{.Home}}/local"
    writable: true
    9p:
      cache: "mmap"
  - location: "~/notes"
    mountPoint: "{{.Home}}/notes"
    writable: true
    9p:
      cache: "mmap"
  - location: "~/.dotfiles.local"
    mountPoint: "{{.Home}}/.dotfiles.local"
    writable: true
    9p:
      cache: "mmap"
cpus: 4
memory: 8GiB
portForwards:
  # Tell Lima's port-forwarding to ignore port 68 to prevent interception of host DHCP packets
  # Apparently this is an issue with NixOS that does not occur on other Linux distros
  # See: https://github.com/nixos-lima/nixos-lima/issues/50
  - proto: udp
    guestPort: 68
    guestIP: 0.0.0.0
    ignore: true
containerd:
  system: false
  user: false
ssh:
  forwardAgent: true
